<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>VivusFisio Plan - Login</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#4A9D82",
            "background-light": "#F0F5F3",
            "background-dark": "#1A2E27",
            "text-light": "#F0F5F3",
            "text-dark": "#101D18",
          },
          fontFamily: {
            "display": ["Manrope"]
          },
          borderRadius: {
            "DEFAULT": "0.375rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="flex flex-col min-h-screen">
<main class="flex-grow flex flex-col justify-center items-center px-6">
<div class="text-center mb-16">
<!-- Logo da Vivus da pasta local -->
<div class="inline-block mb-4">
  <img src="./images/vivuslog.png" alt="Vivus Logo" class="w-16 h-16 mx-auto object-contain" onerror="this.style.display='none'; document.getElementById('fallbackLogo').style.display='flex';">
  
  <!-- Logo de fallback caso a imagem não carregue -->
  <div id="fallbackLogo" class="w-16 h-16 mx-auto bg-primary rounded-full flex items-center justify-center" style="display: none;">
    <svg class="w-10 h-10 text-white" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
      <g fill="currentColor">
        <path d="M15 30 L30 70 L45 30" stroke="currentColor" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M35 30 L50 70 L65 30" stroke="currentColor" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <g transform="translate(75, 45)">
          <rect x="-2" y="-12" width="4" height="24" rx="2" fill="currentColor"/>
          <rect x="-12" y="-2" width="24" height="4" rx="2" fill="currentColor"/>
        </g>
        <circle cx="90" cy="65" r="3" fill="currentColor"/>
      </g>
    </svg>
  </div>
</div>
<h1 class="text-4xl font-extrabold text-text-dark dark:text-text-light">VivusFisio Plan</h1>
</div>

<form id="loginForm" class="w-full max-w-sm mx-auto space-y-6">
<div class="text-center mb-8">
<h2 class="text-2xl font-bold text-text-dark dark:text-text-light mb-1">Acesse sua conta</h2>
<p class="text-text-dark/60 dark:text-text-light/60">Insira seu código único de acesso.</p>
</div>
<div class="flex flex-col">
<label class="sr-only" for="access-code">Código único de acesso</label>
<input class="form-input w-full bg-background-light dark:bg-background-dark border-2 border-text-dark/20 dark:border-text-light/20 rounded-lg h-14 px-4 text-center text-xl tracking-[0.3em] font-bold text-text-dark dark:text-text-light placeholder:text-text-dark/40 dark:placeholder:text-text-light/40 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors duration-300" id="access-code" maxlength="20" placeholder="● ● ● ● ● ●" type="text" autocomplete="off" autocapitalize="characters" spellcheck="false"/>
</div>

<!-- Messages Area -->
<div id="messageArea" class="hidden">
  <div id="errorMessage" class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg mb-4 hidden">
    <div class="flex items-start">
      <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
      </svg>
      <span id="errorText" class="text-sm"></span>
    </div>
  </div>

  <div id="successMessage" class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-300 px-4 py-3 rounded-lg mb-4 hidden">
    <div class="flex items-start">
      <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
      </svg>
      <span id="successText" class="text-sm"></span>
    </div>
  </div>
</div>

<!-- User Info Display -->
<div id="userInfo" class="bg-primary/10 dark:bg-primary/20 border border-primary/20 dark:border-primary/30 px-4 py-3 rounded-lg mb-4 hidden">
  <h3 class="font-bold text-primary mb-2">Bem-vindo(a)!</h3>
  <div class="space-y-1 text-sm text-text-dark dark:text-text-light">
    <p class="break-words"><strong>Nome:</strong> <span id="userName"></span></p>
    <p class="break-words"><strong>Email:</strong> <span id="userEmail"></span></p>
    <p class="break-words"><strong>Especialidade:</strong> <span id="userEspecialidade"></span></p>
    <p><strong>Tipo:</strong> <span id="userMaster"></span></p>
  </div>
</div>

<button type="submit" id="loginBtn" class="w-full h-14 bg-primary text-white font-bold text-lg rounded-lg shadow-lg hover:bg-opacity-90 transition-opacity flex items-center justify-center">
  <span id="btnText">Entrar</span>
  <div id="btnSpinner" class="ml-2 hidden">
    <div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
  </div>
</button>
</form>
</main>
<footer class="py-6 px-6 text-center">
<a class="text-sm text-text-dark/60 dark:text-text-light/60 hover:text-primary dark:hover:text-primary transition-colors" href="#">
        Precisa de ajuda?
      </a>
</footer>
</div>

<script>
    const API_BASE = 'https://api.steinhq.com/v1/storages/68d29050affba40a62ffb0f6';
    
    // Elements
    const loginForm = document.getElementById('loginForm');
    const codigoInput = document.getElementById('access-code');
    const loginBtn = document.getElementById('loginBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    const messageArea = document.getElementById('messageArea');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const errorText = document.getElementById('errorText');
    const successText = document.getElementById('successText');
    const userInfo = document.getElementById('userInfo');

    // Auto-uppercase input
    codigoInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
    });

    // Form submission
    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const codigo = codigoInput.value.trim();
        
        if (!codigo) {
            showError('Por favor, digite seu código de acesso');
            return;
        }

        await performLogin(codigo);
    });

    async function performLogin(codigo) {
        // Show loading state
        setLoadingState(true);
        hideMessages();

        try {
            // Fetch data from Google Sheets via Stein API
            const response = await fetch(`${API_BASE}/fisioterapeutas`);
            
            if (!response.ok) {
                throw new Error('Erro ao conectar com o servidor');
            }

            const fisioterapeutas = await response.json();
            
            // Find user by code
            const user = fisioterapeutas.find(f => f.codigo && f.codigo.toString().toUpperCase() === codigo.toUpperCase());
            
            if (!user) {
                showError('Código de acesso inválido');
                setLoadingState(false);
                return;
            }

            // Success - show user info
            showSuccess(`Login realizado com sucesso!`);
            displayUserInfo(user);
            
            // Store user data in localStorage for the session
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Simulate redirect after 2 seconds
            setTimeout(() => {
                showSuccess('Redirecionando para o sistema...');
                // Here you would typically redirect to the main application
                // window.location.href = '/dashboard';
            }, 2000);

        } catch (error) {
            console.error('Login error:', error);
            showError('Erro ao realizar login. Tente novamente.');
        } finally {
            setLoadingState(false);
        }
    }

    function setLoadingState(loading) {
        if (loading) {
            btnText.textContent = 'Verificando...';
            btnSpinner.classList.remove('hidden');
            loginBtn.disabled = true;
            codigoInput.disabled = true;
        } else {
            btnText.textContent = 'Entrar';
            btnSpinner.classList.add('hidden');
            loginBtn.disabled = false;
            codigoInput.disabled = false;
        }
    }

    function showError(message) {
        errorText.textContent = message;
        errorMessage.classList.remove('hidden');
        successMessage.classList.add('hidden');
        messageArea.classList.remove('hidden');
    }

    function showSuccess(message) {
        successText.textContent = message;
        successMessage.classList.remove('hidden');
        errorMessage.classList.add('hidden');
        messageArea.classList.remove('hidden');
    }

    function hideMessages() {
        messageArea.classList.add('hidden');
        errorMessage.classList.add('hidden');
        successMessage.classList.add('hidden');
    }

    function displayUserInfo(user) {
        document.getElementById('userName').textContent = user.nome || 'N/A';
        document.getElementById('userEmail').textContent = user.email || 'N/A';
        document.getElementById('userEspecialidade').textContent = user.especialidade || 'N/A';
        document.getElementById('userMaster').textContent = user.master === 'TRUE' || user.master === true ? 'Administrador' : 'Usuário';
        
        userInfo.classList.remove('hidden');
    }

    // Check if user is already logged in
    window.addEventListener('load', function() {
        const currentUser = localStorage.getItem('currentUser');
        if (currentUser) {
            const user = JSON.parse(currentUser);
            displayUserInfo(user);
            showSuccess('Você já está logado no sistema');
        }
    });
</script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983a74ff75ebbd0e',t:'MTc1ODYzNDg1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>
